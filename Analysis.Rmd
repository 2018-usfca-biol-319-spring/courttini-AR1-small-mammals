---
title: "Analysis Report 1: NEON Small Mammal Data"
author: "Courtney Lopez"
date: "3/15/2018"
bibliography: references.bib
csl: ecology.csl
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

The National Ecological Observatory Network (NEON) is an ecological observation facility that collects data on rapidly changing ecological processes in the United States. NEON has standardized data from 81 field sites that span across the United States within 20 eco-climatic domains that represent regions of distinct land forms, vegetation, climate, and ecosystem dynamics. NEON measures the causes and effects of environmental change in different types of environments and data sets. 

The different types of field sites include core terrestrial sites, core aquatic sites, relocatable terrestrial sites, and relocatable aquatic sites. The different sites ensure that the data will statistically represent ecological, physical, and biological differences spanning the continent. As seen from the image below, the field sites are also in Alaska, Hawaii, and Puerto Rico. This image shows where the NEON sites are located including where the four different types of sites are located.

![](data/2017_NEONDomainOverview.jpg)

At the varying sites multiple different functional groups of dry mass are recorded depending the location of the site. This includes dry mass of flowers, leaves, mixed, needles, other, seeds, twigs/branches, and woody material. This project however, focusses on the small mammal box trapping data set, which assess abundance and diversity in North America. This data is the "mark-recapture, demographic, and size data collected by box trapping for small mammals" (i.e., rodents < 600 grams). NEON chose to observe these small mammals as they are common to almost every place and they are receptive to changes in the environment. These small mammals are based on a couple different characteristics including taxonomic, behavior, dietary, and size. This dataset recorded for each mammal captured the species identification, size, including length and weight, reproductive capabilities, and other small things in order to identify the species including, blood, ear, hair, whiskers, and fecal samples. This data is important for in the use of public health issues like disease prevalence, accounting for the amount of species that are in certain environments, and specifically for climate changes and land use. 

The small mammal data that I will be focusing on for this analysis are the sites that contain deciduous forest and evergreen forest. Specifically, I will be focusing on the sites Bartlett Experimental Forest (BART), Harvard Forest (HARV), Jones Ecological Research Center (JERC), Oak Ridge (ORNL), and Talladega National Forest (TALL). I also chose to look at the difference in sex and weight of the small mammals, between the two forests at each of the five NEON sites. My hypotheses are the abundance and size of the small mammals will be larger in the evergreen forests than in the decidous forests. I am also currious to find out which of the five NEON sites contains more small mammals and their differences in abundances between the two forests at each site.

These proposed explanations were made based on the conclusions supplied by other research articles. 

Understanding this data is important because it can be used by scientists, researchers, professors, and students to gain knowledge about ecological differences between different environments on recent ongoing data collection. 

(http://www.neonscience.org)


Delete this placeholder text, and replace it with your introduction text. You should include background on the NEON project including proper citations (e.g. [@thorpe2016introduction]), the sets of sites you are comparing, and other relevent background information related to your specific hypotheses. 

# Methods

Describe where the data came from, including how they were collected in the field (information is in the pdf file in the data folder), some information about those sites and why you chose them, and how you are analyzing them (e.g. using R to visualize the results and the statistical tests you will use).

# Results

```{r load-in needed packages}
#load packages needed for any analysis 
library("knitr")
library("dplyr")
library("readr")
library("ggplot2")
library("tidyr")
```

```{r load-in-dataset}
# use readr package function read_csv to load in the small
# mammals big dataset

small_mammal_data <- readr::read_csv("data/raw_data/mam_pertrapnight.csv")
```

```{r summarize-capture-data}
# we would like to get only thr rows that have captured animals in the trap
# and get the count of each sex in each site that are in decidous and evergreen forests
  
forests_filter_data <- small_mammal_data %>%
  filter(trapStatus == "5 - capture") %>%
  filter(nlcdClass %in% c("deciduousForest", "evergreenForest")) %>%
  group_by(siteID, sex, nlcdClass) %>%
  tally() %>%
  spread(nlcdClass, n) %>%
  mutate(num_forest_types = sum((deciduousForest > 0) + (evergreenForest > 0), na.rm = TRUE)) %>%
  filter(num_forest_types == 2) 
```

```{r plot-boxplot-count1}
# create boxplot between number of individuals (sex) in deciduous forests 

ggplot(data = forests_filter_data,
       aes(x = sex,
           y = deciduousForest)) + 
  geom_boxplot() +
  ggtitle("Amount of males and females in deciduous forest at five NEON sites") +
  geom_col(fill = "red")
  
```

```{r plot-boxplot-count2}
# create boxplot between number of small mammals captured at each siteID in deciduous forest 

ggplot(data = forests_filter_data,
       aes(x = siteID,
           y = deciduousForest)) + 
  geom_boxplot() +
  ggtitle("Amount of small mammals in deciduous forest at five NEON sites") +
  geom_col(fill = "red")

```

```{r plot-boxplot-count3}
# create boxplot between number of individuals (sex) in evergreen forests

ggplot(data = forests_filter_data,
       aes(x = sex,
           y = evergreenForest)) + 
  geom_boxplot() +
  ggtitle("Amount of males and females in evergreen forest at five NEON sites") +
  geom_col(fill = "dodger blue")

```

```{r plot-boxplot-count4}
# create boxplot between number of small mammals captured at each siteID in evergreen forest 

ggplot(data = forests_filter_data,
       aes(x = siteID,
           y = evergreenForest)) + 
  geom_boxplot() +
  ggtitle("Amount of small mammals in evergreen forest at five NEON sites") +
  geom_col(fill = "dodger blue")

```

```{r summarize-capture-data-and-weight}
# filter out sites that contain both evergreen and deciduous forest 
# and summarise the total weight 

weight_data <- small_mammal_data %>% 
  filter(trapStatus == "5 - capture") %>%
  filter(siteID %in% c("BART", "HARV", "JERC", "ORNL", "TALL")) %>%
  group_by(siteID, sex) %>%
  summarise(total_weight = sum(weight, na.rm = TRUE))
```

```{r plot-boxplot-weight-siteID}
# create a boxplot with the 5 NEON siteIDs versus the weight 

ggplot(data = weight_data,
       aes(x = siteID,
           y = total_weight)) +
  geom_boxplot() +
  ggtitle("Total weight of small mammals at 5 NEON sites") +
  geom_col(fill = "dark green")

```

```{r plot-boxplot-weight-sex}
# create a boxplot with the sex versus the weight 

ggplot(data = weight_data,
       aes(x = sex,
           y = total_weight)) +
  geom_boxplot() +
  ggtitle("Total weight of small mammals of each sex") +
  geom_col(fill = "dark green")

```


```{r summary-table-of-weight-in-class-example}
# I want to make a summary table of the average weight and standard deviation
# of all trapped rodents grouped by site, and excluding NA values 

small_mammal_data %>%
  filter(trapStatus == "5 - capture") %>%
  group_by(siteID) %>%
  summarise(mean_weight = mean(weight, na.rm = TRUE),
            sd_weight = sd(weight, na.rm = TRUE)) %>%
  filter(siteID %in% c("BART", "BLAN", "CLBJ")) %>%
  ggplot(aes(x= siteID, y = mean_weight)) +
  geom_col(fill = "dodger blue") + 
  geom_errorbar(aes(x = siteID,
                    ymin = mean_weight - sd_weight,
                    ymax = mean_weight + sd_weight),
                width = 0.2) + 
  ggtitle("Average weight in grams of mammals at three NEON sites")
```

Add a number of code chunks in the Results section. These should read in, subset and plot the data as needed (no need to save any figures to pdf, since they will be put into the rendered document when you click 'knit'), and, for any hypotheses that you want to test, an appropriate statistical test. You should have at least 5 figures and/or tables in this section, which you use to test your hypotheses against the dataset.

# Discussion

Discuss the results you found in the context of what you know about the site/sites and the predominant types of vegatation in those locations. Think also about the community dynamics of the mammal community at each of the sites, in the context of what you know about different types of species interactions, food webs, trophic transfer, etc.

# Sources Cited


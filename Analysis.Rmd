---
title: "Analysis Report 1: NEON Small Mammal Data"
author: "Courtney Lopez"
date: "3/15/2018"
bibliography: references.bib
csl: ecology.csl
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction



Delete this placeholder text, and replace it with your introduction text. You should include background on the NEON project including proper citations (e.g. [@thorpe2016introduction]), the sets of sites you are comparing, and other relevent background information related to your specific hypotheses. 

# Methods

Describe where the data came from, including how they were collected in the field (information is in the pdf file in the data folder), some information about those sites and why you chose them, and how you are analyzing them (e.g. using R to visualize the results and the statistical tests you will use).

# Results

```{r load-in needed packages}
#load packages needed for any analysis 
library("knitr")
library("dplyr")
library("readr")
library("ggplot2")
library("tidyr")
```

```{r load-in-dataset}
# use readr package function read_csv to load in the small
# mammals big dataset

small_mammal_data <- readr::read_csv("data/raw_data/mam_pertrapnight.csv")
```

```{r summarize-capture-data}
# we would like to get only thr rows that have captured animals in the trap
# and get the count of each sex in each site that are in decidous and evergreen forests
  
forests_filter_data <- small_mammal_data %>%
  filter(trapStatus == "5 - capture") %>%
  filter(nlcdClass %in% c("deciduousForest", "evergreenForest")) %>%
  group_by(siteID, sex, nlcdClass) %>%
  tally() %>%
  spread(nlcdClass, n) %>%
  mutate(num_forest_types = sum((deciduousForest > 0) + (evergreenForest > 0), na.rm = TRUE)) %>%
  filter(num_forest_types == 2) 
```

```{r plot-boxplot-count1}
# create boxplot between number of individuals (sex) in deciduous forests 

ggplot(data = forests_filter_data,
       aes(x = sex,
           y = deciduousForest)) + 
  geom_boxplot() +
  ggtitle("Amount of males and females in deciduous forest at five NEON sites") +
  geom_col(fill = "red")
  
```

```{r plot-boxplot-count2}
# create boxplot between number of small mammals captured at each siteID in deciduous forest 

ggplot(data = forests_filter_data,
       aes(x = siteID,
           y = deciduousForest)) + 
  geom_boxplot() +
  ggtitle("Amount of small mammals in deciduous forest at five NEON sites") +
  geom_col(fill = "red")

```

```{r plot-boxplot-count3}
# create boxplot between number of individuals (sex) in evergreen forests

ggplot(data = forests_filter_data,
       aes(x = sex,
           y = evergreenForest)) + 
  geom_boxplot() +
  ggtitle("Amount of males and females in evergreen forest at five NEON sites") +
  geom_col(fill = "dodger blue")

```

```{r plot-boxplot-count4}
# create boxplot between number of small mammals captured at each siteID in evergreen forest 

ggplot(data = forests_filter_data,
       aes(x = siteID,
           y = evergreenForest)) + 
  geom_boxplot() +
  ggtitle("Amount of small mammals in evergreen forest at five NEON sites") +
  geom_col(fill = "dodger blue")

```

```{r summarize-capture-data-and-weight}
# filter out sites that contain both evergreen and deciduous forest 
# and summarise the total weight 

weight_data <- small_mammal_data %>% 
  filter(trapStatus == "5 - capture") %>%
  filter(siteID %in% c("BART", "HARV", "JERC", "ORNL", "TALL")) %>%
  group_by(siteID, sex) %>%
  summarise(total_weight = sum(weight, na.rm = TRUE))
```

```{r plot-boxplot-weight-siteID}
# create a boxplot with the 5 NEON siteIDs versus the weight 

ggplot(data = weight_data,
       aes(x = siteID,
           y = total_weight)) +
  geom_boxplot() +
  ggtitle("Total weight of small mammals at 5 NEON sites") +
  geom_col(fill = "dark green")

```

```{r plot-boxplot-weight-sex}
# create a boxplot with the sex versus the weight 

ggplot(data = weight_data,
       aes(x = sex,
           y = total_weight)) +
  geom_boxplot() +
  ggtitle("Total weight of small mammals of each sex") +
  geom_col(fill = "dark green")

```


```{r summary-table-of-weight-in-class-example}
# I want to make a summary table of the average weight and standard deviation
# of all trapped rodents grouped by site, and excluding NA values 

small_mammal_data %>%
  filter(trapStatus == "5 - capture") %>%
  group_by(siteID) %>%
  summarise(mean_weight = mean(weight, na.rm = TRUE),
            sd_weight = sd(weight, na.rm = TRUE)) %>%
  filter(siteID %in% c("BART", "BLAN", "CLBJ")) %>%
  ggplot(aes(x= siteID, y = mean_weight)) +
  geom_col(fill = "dodger blue") + 
  geom_errorbar(aes(x = siteID,
                    ymin = mean_weight - sd_weight,
                    ymax = mean_weight + sd_weight),
                width = 0.2) + 
  ggtitle("Average weight in grams of mammals at three NEON sites")
```

Add a number of code chunks in the Results section. These should read in, subset and plot the data as needed (no need to save any figures to pdf, since they will be put into the rendered document when you click 'knit'), and, for any hypotheses that you want to test, an appropriate statistical test. You should have at least 5 figures and/or tables in this section, which you use to test your hypotheses against the dataset.

# Discussion

Discuss the results you found in the context of what you know about the site/sites and the predominant types of vegatation in those locations. Think also about the community dynamics of the mammal community at each of the sites, in the context of what you know about different types of species interactions, food webs, trophic transfer, etc.

# Sources Cited

